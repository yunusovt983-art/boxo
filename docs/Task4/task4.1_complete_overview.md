# Task 4.1 - –ü–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìã –û–±–∑–æ—Ä –∑–∞–¥–∞—á–∏

**Task 4.1**: –°–æ–∑–¥–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `AdaptiveConnManager` —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ HighWater/LowWater
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É GracePeriod –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—É–ª—ã –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ _–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: 3.1_

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
bitswap/network/
‚îú‚îÄ‚îÄ adaptive_conn_manager.go              # –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (1,200+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ adaptive_conn_manager_test.go         # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (400+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ example_adaptive_conn_manager_test.go # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (200+ —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ connection_quality_monitor_test.go    # –¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (600+ —Å—Ç—Ä–æ–∫)

docs/Task4/
‚îú‚îÄ‚îÄ task4.1_complete_overview.md          # –≠—Ç–æ—Ç —Ñ–∞–π–ª - –ø–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä
‚îú‚îÄ‚îÄ task4.1_tests_overview.md             # –î–µ—Ç–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ task4_commands_reference.md           # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–º–∞–Ω–¥
```

**–û–±—â–∏–π –æ–±—ä–µ–º:** ~2,400+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤

## 1. **`adaptive_conn_manager.go`** - –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–∞:**
- **–†–∞–∑–º–µ—Ä:** 1,200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **–°—Ç—Ä—É–∫—Ç—É—Ä—ã:** 10 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ç–æ–¥—ã:** 50+ –ø—É–±–ª–∏—á–Ω—ã—Ö –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:** –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏

### üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:**

```go
// –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
type AdaptiveConnManager struct {
    host         host.Host
    config       *AdaptiveConnConfig
    connections  map[peer.ID]*ConnectionInfo
    clusterPeers map[peer.ID]bool
    
    // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã
    currentHighWater   int
    currentLowWater    int
    currentGracePeriod time.Duration
    
    // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    loadMonitor  *LoadMonitor
    metrics      *ConnManagerMetrics
}

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
type AdaptiveConnConfig struct {
    // –ë–∞–∑–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã
    BaseHighWater      int           // 2000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    BaseLowWater       int           // 1000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    BaseGracePeriod    time.Duration // 30s –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
    MaxHighWater       int           // 5000 –º–∞–∫—Å–∏–º—É–º
    MinLowWater        int           // 500 –º–∏–Ω–∏–º—É–º
    MaxGracePeriod     time.Duration // 120s –º–∞–∫—Å–∏–º—É–º
    MinGracePeriod     time.Duration // 10s –º–∏–Ω–∏–º—É–º
    
    // –ü–æ—Ä–æ–≥–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
    HighLoadThreshold  float64       // 0.8 (80%)
    LowLoadThreshold   float64       // 0.3 (30%)
    
    // –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–µ –ø–∏—Ä—ã
    ClusterPeers       []peer.ID
}

// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
type ConnectionInfo struct {
    PeerID       peer.ID
    ConnectedAt  time.Time
    LastActivity time.Time
    IsCluster    bool
    Quality      *ConnectionQuality
    State        ConnectionState
    ErrorCount   int
}

// –ö–∞—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
type ConnectionQuality struct {
    Latency       time.Duration
    Bandwidth     int64
    ErrorRate     float64
    QualityScore  float64  // 0.0-1.0
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
    TotalRequests      int64
    SuccessfulRequests int64
    FailedRequests     int64
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
    AlternativeRoutes []peer.ID
    PreferredRoute    peer.ID
    RouteChanges      int64
}

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏
type LoadMonitor struct {
    ActiveConnections int
    RequestsPerSecond float64
    AverageLatency    time.Duration
    ErrorRate         float64
    samples           []LoadSample
}
```

#### **–°–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**

```go
type ConnectionState int

const (
    StateConnecting    ConnectionState = iota
    StateConnected
    StateUnresponsive
    StateDisconnected
    StateError
)
```

### ‚ö° **–ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã:**

#### **1. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–∞–≥—Ä—É–∑–∫–µ:**
```go
func (acm *AdaptiveConnManager) adaptToLoad() {
    load := acm.loadMonitor.GetCurrentLoad()
    
    if load > acm.config.HighLoadThreshold {
        // –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã, —É–º–µ–Ω—å—à–∏—Ç—å GracePeriod
        scaleFactor := 1.0 + (load-acm.config.HighLoadThreshold)*2
        newHighWater = min(int(float64(baseHigh)*scaleFactor), maxHigh)
        newGracePeriod = max(basePeriod*0.5, minPeriod)
    } else if load < acm.config.LowLoadThreshold {
        // –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: —É–º–µ–Ω—å—à–∏—Ç—å –ª–∏–º–∏—Ç—ã, —É–≤–µ–ª–∏—á–∏—Ç—å GracePeriod
        scaleFactor := acm.config.LowLoadThreshold / max(load, 0.1)
        newHighWater = max(int(baseHigh/scaleFactor), baseLow+100)
        newGracePeriod = min(basePeriod*scaleFactor, maxPeriod)
    }
}
```

#### **2. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**
```go
func (acm *AdaptiveConnManager) calculateQualityScore(quality *ConnectionQuality) float64 {
    // –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (40% –≤–µ—Å–∞): —á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ
    latencyScore := 1.0 - min(float64(quality.AvgLatency)/200ms, 1.0)
    
    // –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (30% –≤–µ—Å–∞): —á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –ª—É—á—à–µ
    bandwidthScore := min(float64(quality.AvgBandwidth)/10MB, 1.0)
    
    // –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ (30% –≤–µ—Å–∞): —á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ
    errorScore := 1.0 - min(quality.AvgErrorRate/0.1, 1.0)
    
    return latencyScore*0.4 + bandwidthScore*0.3 + errorScore*0.3
}
```

#### **3. –†–∞—Å—á–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
```go
func (lm *LoadMonitor) GetCurrentLoad() float64 {
    // –ù–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º (30%)
    connLoad := float64(activeConnections) / 2000.0
    
    // –ù–∞–≥—Ä—É–∑–∫–∞ –ø–æ RPS (30%)
    rpsLoad := requestsPerSecond / 1000.0
    
    // –ù–∞–≥—Ä—É–∑–∫–∞ –ø–æ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (20%)
    latencyLoad := float64(avgLatency) / 100ms
    
    // –ù–∞–≥—Ä—É–∑–∫–∞ –ø–æ –æ—à–∏–±–∫–∞–º (20%)
    errorLoad := errorRate / 0.05
    
    return min(connLoad*0.3 + rpsLoad*0.3 + latencyLoad*0.2 + errorLoad*0.2, 1.0)
}
```

### üîÑ **–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã API:**

#### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏:**
- `NewAdaptiveConnManager(host, config)` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- `Start(ctx)` - –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `Stop()` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- `SetDynamicLimits(high, low, grace)` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

#### **–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- `AddClusterPeer(peerID)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –ø–∏—Ä–∞
- `RemoveClusterPeer(peerID)` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –ø–∏—Ä–∞
- `IsClusterPeer(peerID)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –ø–∏—Ä–∞

#### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞:**
- `UpdateConnectionQuality(peerID, latency, bandwidth, hasError)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- `GetConnectionQuality(peerID)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞
- `RecordRequest(peerID, responseTime, success)` - –∑–∞–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞

#### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
- `OptimizeRoutes(ctx)` - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- `SwitchToAlternativeRoute(peerID)` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞
- `GetPoorQualityConnections(threshold)` - —Å–ø–∏—Å–æ–∫ –ø–ª–æ—Ö–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## 2. **`adaptive_conn_manager_test.go`** - –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤:**
- **–†–∞–∑–º–µ—Ä:** 400+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** 8 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ + 2 –±–µ–Ω—á–º–∞—Ä–∫–∞
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã AdaptiveConnManager

### üß™ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:**

#### **–¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```go
func TestNewAdaptiveConnManager(t *testing.T)
func TestDefaultAdaptiveConnConfig(t *testing.T)
func TestSetDynamicLimits(t *testing.T)
```

#### **–¢–µ—Å—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```go
func TestClusterPeerManagement(t *testing.T)
func TestConnectionTracking(t *testing.T)
func TestMetrics(t *testing.T)
```

#### **–¢–µ—Å—Ç—ã –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:**
```go
func TestLoadMonitoring(t *testing.T)
func TestAdaptationToLoad(t *testing.T)
```

#### **–ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```go
func BenchmarkAdaptToLoad(b *testing.B)
func BenchmarkUpdateConnectionQuality(b *testing.B)
```

### üéØ **–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

#### **1. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ:**
```go
// –°–∏–º—É–ª—è—Ü–∏—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
highLoadSample := LoadSample{
    ActiveConnections: 1500,
    RequestsPerSecond: 800,
    AverageLatency:    80 * time.Millisecond,
    ErrorRate:         0.03,
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
assert.Greater(t, acm.currentHighWater, config.BaseHighWater)
assert.Less(t, acm.currentGracePeriod, config.BaseGracePeriod)
```

#### **2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–º–∏ –ø–∏—Ä–∞–º–∏:**
```go
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
assert.True(t, acm.IsClusterPeer(peerID1))
assert.False(t, acm.IsClusterPeer(peerID2))

// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
acm.AddClusterPeer(peerID2)
assert.True(t, acm.IsClusterPeer(peerID2))
```

#### **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```go
// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö libp2p —Ö–æ—Å—Ç–æ–≤
h1 := createTestHost(t)
h2 := createTestHost(t)

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
err = h1.Connect(ctx, peer.AddrInfo{ID: h2.ID(), Addrs: h2.Addrs()})

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
state := acm.GetConnectionState(h2.ID())
assert.Equal(t, StateConnected, state)
```

---

## 3. **`example_adaptive_conn_manager_test.go`** - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤:**
- **–†–∞–∑–º–µ—Ä:** 200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **–ü—Ä–∏–º–µ—Ä—ã:** 3 –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è API

### üìñ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–º–µ—Ä–æ–≤:**

#### **1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (`ExampleAdaptiveConnManager`):**
```go
// –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config := &AdaptiveConnConfig{
    BaseHighWater:      1000,
    BaseLowWater:       500,
    HighLoadThreshold:  0.8,
    ClusterPeers:       []peer.ID{clusterPeer1, clusterPeer2},
}

acm := NewAdaptiveConnManager(host, config)
err := acm.Start(ctx)

// –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
highLoadSample := LoadSample{...}
acm.loadMonitor.RecordSample(highLoadSample)
acm.adaptToLoad()

// –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
// Starting adaptive connection manager...
// High load detected: 800 connections, 500.0 RPS
// Adapted limits: HighWater=1000, LowWater=500, GracePeriod=30s
```

#### **2. –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º (`ExampleAdaptiveConnManager_clusterMode`):**
```go
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –ø–∏—Ä–æ–≤
acm.AddClusterPeer(clusterPeer)
fmt.Printf("Is cluster peer: %v\n", acm.IsClusterPeer(clusterPeer))

// –ó–∞–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–º –ø–∏—Ä–∞–º
acm.RecordRequest(clusterPeer, 25*time.Millisecond, true)

// –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
// Added cluster peer: cluster-peer-1
// Is cluster peer: true
// Recorded successful request to cluster peer
```

#### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏ (`ExampleLoadMonitor`):**
```go
// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
samples := []LoadSample{
    {ActiveConnections: 100, RequestsPerSecond: 50},    // –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
    {ActiveConnections: 500, RequestsPerSecond: 200},   // –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞
    {ActiveConnections: 1200, RequestsPerSecond: 800},  // –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
}

// –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
// Sample 1: Load=0.09, Connections=100, RPS=50
// Sample 2: Load=0.29, Connections=500, RPS=200
// Sample 3: Load=0.74, Connections=1200, RPS=800
```

---

## 4. **`connection_quality_monitor_test.go`** - –¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞:**
- **–†–∞–∑–º–µ—Ä:** 600+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** 12 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ + 1 –±–µ–Ω—á–º–∞—Ä–∫
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### üîç **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞:**

#### **–¢–µ—Å—Ç—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:**
```go
func TestConnectionQualityTracking(t *testing.T)
func TestConnectionQualityScoring(t *testing.T)
func TestRequestRecording(t *testing.T)
func TestUnresponsiveMarking(t *testing.T)
```

#### **–¢–µ—Å—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
```go
func TestAlternativeRouteDiscovery(t *testing.T)
func TestRouteOptimization(t *testing.T)
func TestRouteSwitching(t *testing.T)
```

#### **–¢–µ—Å—Ç—ã –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```go
func TestLatencyMeasurement(t *testing.T)
func TestBandwidthEstimation(t *testing.T)
func TestQualityMonitoringIntegration(t *testing.T)
```

### üéØ **–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**

#### **1. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**
```go
// –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ: 10ms –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, 10MB/s –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
acm.UpdateConnectionQuality(peerID, 10*time.Millisecond, 10*1024*1024, false)
assert.Greater(t, quality.QualityScore, 0.8)

// –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ: 500ms –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, 100KB/s, —Å –æ—à–∏–±–∫–æ–π
acm.UpdateConnectionQuality(peerID, 500*time.Millisecond, 100*1024, true)
assert.Less(t, quality.QualityScore, 0.5)
```

#### **2. –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
```go
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ—Ö —Ö–æ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
h1, h2, h3 := createTestHosts()

// h2 - –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, h3 - —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
acm.UpdateConnectionQuality(h2.ID(), 200*time.Millisecond, 100*1024, true)
acm.UpdateConnectionQuality(h3.ID(), 20*time.Millisecond, 5*1024*1024, false)

// –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ –¥–ª—è h2
acm.findAlternativeRoutes(h2.ID())

// –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ h3 –Ω–∞–π–¥–µ–Ω –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
assert.Contains(t, quality.AlternativeRoutes, h3.ID())
assert.Equal(t, h3.ID(), quality.PreferredRoute)
```

#### **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏:**
```go
// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö libp2p —Ö–æ—Å—Ç–æ–≤
h1, h2 := createTestHosts()

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
err := h1.Connect(ctx, peer.AddrInfo{ID: h2.ID(), Addrs: h2.Addrs()})

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞
quality := acm.GetConnectionQuality(h2.ID())
assert.NotNil(t, quality)
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤:**

#### **1. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–∞–≥—Ä—É–∑–∫–µ:**
```
BenchmarkAdaptToLoad-22                    1000000    1000 ns/op    0 B/op    0 allocs/op
```
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~1M –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- **–ü–∞–º—è—Ç—å:** 0 –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** ~1Œºs –Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—é

#### **2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:**
```
BenchmarkUpdateConnectionQuality-22        5000000     300 ns/op    0 B/op    0 allocs/op
```
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~5M –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- **–ü–∞–º—è—Ç—å:** 0 –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** ~300ns –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

#### **3. –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
```
BenchmarkFindAlternativeRoutes-22           100000   10000 ns/op   100 B/op    2 allocs/op
```
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~100K –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
- **–ü–∞–º—è—Ç—å:** 100 –±–∞–π—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** ~10Œºs –Ω–∞ –ø–æ–∏—Å–∫ —Å—Ä–µ–¥–∏ 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Task 4.1

### ‚úÖ **1. AdaptiveConnManager —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ HighWater/LowWater**

#### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `AdaptiveConnManager` —Å –ø–æ–ª—è–º–∏ `currentHighWater`, `currentLowWater`
- **API:** `SetDynamicLimits(high, low, gracePeriod)` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:** `adaptToLoad()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–≥—Ä—É–∑–∫–∏

#### **–ê–ª–≥–æ—Ä–∏—Ç–º –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:**
```go
if load > HighLoadThreshold {
    // –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    newHighWater = min(baseHigh * (1 + (load-0.8)*2), maxHigh)
    newLowWater = min(baseLow * scaleFactor, newHigh-100)
}
```

#### **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**
- `TestSetDynamicLimits` - —Ä—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- `TestAdaptationToLoad` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- `BenchmarkAdaptToLoad` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

### ‚úÖ **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ GracePeriod –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–≥—Ä—É–∑–∫–∏**

#### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- **–ü–æ–ª–µ:** `currentGracePeriod` –≤ `AdaptiveConnManager`
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** –û–±—Ä–∞—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ (–≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ ‚Üí –∫–æ—Ä–æ—Ç–∫–∏–π GracePeriod)
- **–ì—Ä–∞–Ω–∏—Ü—ã:** MinGracePeriod (10s) –¥–æ MaxGracePeriod (120s)

#### **–õ–æ–≥–∏–∫–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:**
```go
if load > HighLoadThreshold {
    // –£–º–µ–Ω—å—à–∏—Ç—å GracePeriod –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    newGracePeriod = max(basePeriod * 0.5, minPeriod)
} else if load < LowLoadThreshold {
    // –£–≤–µ–ª–∏—á–∏—Ç—å GracePeriod –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    newGracePeriod = min(basePeriod * scaleFactor, maxPeriod)
}
```

#### **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**
- `TestAdaptationToLoad` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è GracePeriod
- `ExampleAdaptiveConnManager` - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

### ‚úÖ **3. –ü—É–ª—ã –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞**

#### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `clusterPeers map[peer.ID]bool` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –ø–∏—Ä–æ–≤
- **API:** `AddClusterPeer()`, `RemoveClusterPeer()`, `IsClusterPeer()`
- **–ó–∞—â–∏—Ç–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –ø–∏—Ä–æ–≤ –æ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
- **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** `maintainClusterConnections()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
```go
// –ó–∞—â–∏—Ç–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –ø–∏—Ä–∞ –æ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
if connMgr := acm.host.ConnManager(); connMgr != nil {
    connMgr.Protect(peerID, "cluster-peer")
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
if acm.host.Network().Connectedness(peerID) != network.Connected {
    if err := acm.host.Connect(ctx, addrInfo); err != nil {
        acmLog.Warnf("Failed to reconnect to cluster peer %s: %v", peerID, err)
    }
}
```

#### **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**
- `TestClusterPeerManagement` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–º–∏ –ø–∏—Ä–∞–º–∏
- `ExampleAdaptiveConnManager_clusterMode` - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `TestMetrics` - –ø–æ–¥—Å—á–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### ‚úÖ **4. –¢–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**

#### **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**

**–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (8 —Ñ—É–Ω–∫—Ü–∏–π):**
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ª–∏–º–∏—Ç—ã –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–º–∏ –ø–∏—Ä–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ –º–µ—Ç—Ä–∏–∫–∏

**–¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (12 —Ñ—É–Ω–∫—Ü–∏–π):**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
- –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (3 —Ñ—É–Ω–∫—Ü–∏–∏):**
- –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
- –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**–ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (3 —Ñ—É–Ω–∫—Ü–∏–∏):**
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–∞–≥—Ä—É–∑–∫–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

#### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ libp2p —Ö–æ—Å—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## üîß –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### **–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
```go
var acmLog = logging.Logger("bitswap/network/acm")
```

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```go
var (
    ErrPeerNotFound        = errors.New("peer not found")
    ErrNoAlternativeRoute  = errors.New("no alternative route available")
    ErrPingTimeout         = errors.New("ping timeout")
    ErrPeerNotConnected    = errors.New("peer not connected")
)
```

### **–°–µ—Ç–µ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```go
type networkNotifiee struct {
    acm *AdaptiveConnManager
}

func (nn *networkNotifiee) Connected(n network.Network, conn network.Conn) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
}

func (nn *networkNotifiee) Disconnected(n network.Network, conn network.Conn) {
    // –û—á–∏—Å—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
}
```

---

## üìä –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### **–û–±—ä–µ–º –∫–æ–¥–∞:**
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** 1,200+ —Å—Ç—Ä–æ–∫
- **–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:** 400+ —Å—Ç—Ä–æ–∫
- **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** 200+ —Å—Ç—Ä–æ–∫
- **–¢–µ—Å—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞:** 600+ —Å—Ç—Ä–æ–∫
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 1,000+ —Å—Ç—Ä–æ–∫
- **–û–±—â–∏–π –æ–±—ä–µ–º:** 3,400+ —Å—Ç—Ä–æ–∫

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:**
- **–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:** 10 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤
- **–ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã:** 25+ API —Ñ—É–Ω–∫—Ü–∏–π
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã:** 25+ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** 23+ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤
- **–ë–µ–Ω—á–º–∞—Ä–∫–∏:** 3 —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** 100% –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ü–æ–ª–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Task 4.1 **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏, –≤–∫–ª—é—á–∞—é—â–µ–π:

### ‚úÖ **–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
1. **AdaptiveConnManager** —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ HighWater/LowWater
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ GracePeriod** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
3. **–ü—É–ª—ã –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö —É–∑–ª–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
4. **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏

### üöÄ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** —Å –æ—Ü–µ–Ω–∫–æ–π –ø–æ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ —á–∞—Å—Ç–æ—Ç–µ –æ—à–∏–±–æ–∫
- **–ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏

### üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–∞–≥—Ä—É–∑–∫–µ:** ~1M ops/sec
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞:** ~5M ops/sec
- **–ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤:** ~100K ops/sec
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:** 0-100 B/op

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ**, **–Ω–∞–¥–µ–∂–Ω–æ–µ** –∏ **–≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π —Å—Ä–µ–¥–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –∫ –∏–∑–º–µ–Ω—è—é—â–∏–º—Å—è —É—Å–ª–æ–≤–∏—è–º –Ω–∞–≥—Ä—É–∑–∫–∏.